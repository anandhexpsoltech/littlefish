<?php/* Template Name: Overview Page Template */get_header();?>	<?php if( get_field('header_image') ): ?>		<?php $image = get_field('header_image'); ?>		<div class="header-image">			<img src="<?php echo $image['url']; ?>" alt="">		</div>	<?php endif; ?>	<?php    global $current_custom_user;    $current_user_field = 'user_' . $current_custom_user;    global $wpdb;    $current_title = esc_html(get_the_title());    $sql = "SELECT     item_tracking.Option,    expense.Date,    expense.Reference,    expense.Total,     expense.Type,     expense.IsReconciled,    bank_feed.Balance,    month(expense.Date) as date_month,    year(expense.Date) as date_year    FROM xero_expense AS expense    LEFT JOIN xero_expense_lineitem as lineitem ON lineitem.BankTransactionID = expense.BankTransactionID    LEFT JOIN xero_expense_item_tracking as item_tracking ON item_tracking.LineItemID = lineitem.LineItemID    LEFT JOIN xero_bank_feed as bank_feed ON bank_feed.Reference = expense.Reference    AND convert(bank_feed.Date,DATE) = convert(expense.Date,DATE)    WHERE bank_feed.Reference!= ''    order by expense.Date desc";    $bank_feed = $wpdb->get_results($sql);    $templateData = array();    foreach ( $bank_feed as $bank_feed_key => $bank_feed_value )    {        $templateData[$bank_feed_value->date_year][$bank_feed_value->date_month][] = $bank_feed_value;    }//  menu_list    $sql = "SELECT     item_track.Option as name,     SUM(lineitem.LineAmount) as CountValue    FROM xero_expense_lineitem AS lineitem    LEFT JOIN xero_expense_item_tracking as item_track ON lineitem.LineItemID = item_track.LineItemID    WHERE lineitem.LineItemID = item_track.LineItemID    GROUP BY item_track.Option";    $result = $wpdb->get_results($sql);    $totVal = 0;	?><div class="main-container" style="background-image: url(<?php the_field('header_background'); ?>)">    <div class="wrapper overflow main_projects">        <main role="main">            <div class="tabs project_tabs">                <ul id="tabs">                    <li>                        <a id="tab1">                            <h2 class="title wow animated fadeIn">                                <?php the_title(); ?>                            </h2>                        </a>                    </li>                    <li>                        <a id="tab2">                            <div class="title wow animated fadeIn">                                <p>Bank Feed</p>                            </div>                        </a>                    </li>                    <li>                        <div class="col-lg-12 col-md-12 main_menu wow animated fadeIn">                                <ul>                                    <li class="dropdown">                                        <p>Expense Summary &#9662;</p>                                        <div class="dropdown-menu">                                            <div class="list_top_section">                                                <span class="pro_title">Project</span>                                                <span class="pro_spend">Spend</span>                                            </div>                                            <ul>                                                <?php                                                if($result){                                                    foreach ($result as $values ){                                                        $totVal +=$values->CountValue;                                                        ?>                                                        <li class="items_inner">                                                            <span class="pro_title"><?php echo $values->name; ?></span>                                                            <span class="pro_spend"><?php echo $values->CountValue? '$'. number_format($values->CountValue,2,'.',','): '0$' ;; ?></span>                                                        </li>                                                    <?php }}else{ ?>                                                <?php } ?>                                            </ul>                                            <div class="list_bm_section">                                                <span class="pro_title">Total Spend</span>                                                <span class="pro_spend"><?php echo $totVal ? '$'. number_format($totVal,2,'.',','): '0$' ; ?></span>                                            </div>                                        </div>                                    </li>                                </ul>                            </div>                    </li>                </ul>                <div class="container" id="tab1C"><?php get_template_part('loop-clients'); ?></div>                <div class="container" id="tab2C">                    <?php                    if(count($templateData)){ ?>                        <div class="panel panel-default list_table">                            <div class="panel-body">                                <table class="table table-condensed">                                    <thead>                                    <tr>                                        <th>Date</th>                                        <th>Project</th>                                        <th>Reference</th>                                        <th>Debit</th>                                        <th>Credit</th>                                        <th>Balance</th>                                        <th>Status</th>                                    </tr>                                    </thead>                                    <tbody>                                    <?php                                    $total_balance = 0;                                    foreach ( $templateData as $year => $months ){                                        foreach ($months as $month => $listDatas){                                            $dateObj   = DateTime::createFromFormat('!m', $month);                                            $monthName = $dateObj->format('M');                                            ?>                                            <tr>                                                <td colspan="12" class="main_head_bg">                                                    <div role="button" data-toggle="collapse" href="#list_<?php echo $year.'_'.$month?>"                                                         class="accordion-toggle collapsed" aria-expanded="true">                                                        <span class="text_right"><?php echo $monthName, ' ', $year; ?></span>                                                    </div>                                                </td>                                            </tr>                                            <tr>                                                <td colspan="12" class="hiddenRow">                                                    <div class="accordian-body collapse" id="list_<?php echo $year.'_'.$month?>">                                                        <table class="table">                                                            <tbody>                                                            <?php                                                            foreach ( $listDatas as $listData ){                                                                $total_balance+=$listData->Balance;                                                                ?>                                                                <tr>                                                                    <td>                                                                        <?php                                                                            $date=date_create($listData->Date);                                                                            echo date_format($date,"d M Y") ? date_format($date,"d M Y") : '';                                                                        ?>                                                                    </td>                                                                    <td><?php echo $listData->Option;?> </td>                                                                    <td><?php echo $listData->Reference;?> </td>                                                                    <td>                                                                        <?php if ($listData->Type == 'SPEND'){                                                                          echo $listData->Total ? '$' . number_format($listData->Total, 2, '.', ',') : '$0'; ?>                                                                        <?php } ?>                                                                    </td>                                                                    <td>                                                                        <?php if ($listData->Type == 'RECEIVE'){                                                                          echo $listData->Total ? '$' . number_format($listData->Total, 2, '.', ',') : '$0'; ?>                                                                        <?php } ?>                                                                    </td>                                                                    <td>                                                                        <?php                                                                            echo $listData->Balance ? '$' . number_format($listData->Balance, 2, '.', ',') : '$0';                                                                        ?>                                                                    </td>                                                                    <td class="<?php echo $listData->IsReconciled == 1 ? 'recon ':'unrecon' ?>">                                                                        <?php                                                                          echo $listData->IsReconciled == 1 ? 'Reconciled ':'Unreconciled';                                                                        ?>                                                                    </td>                                                                </tr>                                                            <?php } ?>                                                            </tbody>                                                        </table>                                                    </div>                                                </td>                                            </tr>                                        <?php }} ?>                                    <tr class="amount_cal">                                        <td>                                        </td>                                        <td>                                        </td>                                        <td>                                        </td>                                        <td>                                        </td>                                        <td>Closing Balance                                        </td>                                        <td>                                            <?php echo $total_balance? '$' . $total_balance : '$0'; ?>                                        </td>                                        <td>                                        </td>                                    </tr>                                    </tbody>                                </table>                            </div>                        </div>                    <?php }?>                </div>            </div>        </main>    </div></div><script>    jQuery(document).ready(function(){        jQuery(".main_menu .dropdown").click(function(){            jQuery(this).find(".dropdown-menu").slideToggle("fast");        });        jQuery('#tabs li:first-child a').addClass('isActive');        jQuery('#tabs li a:not(:first)').addClass('inactive');        jQuery('.container').hide();        jQuery('.container:first').show();        jQuery('#tabs li a').click(function(){            var t = jQuery(this).attr('id');            if(jQuery(this).hasClass('inactive')){ //this is the start of our condition                jQuery('#tabs li a').addClass('inactive');                jQuery('#tabs li a').removeClass('isActive');                jQuery(this).removeClass('inactive');                jQuery(this).addClass('isActive');                jQuery('.container').hide();                jQuery('#'+ t + 'C').fadeIn('slow');            }        });    });    jQuery(document).on("click", function(event){        var $trigger = jQuery(".dropdown");        if($trigger !== event.target && !$trigger.has(event.target).length){            jQuery(".dropdown-menu").slideUp("fast");        }    });</script><script src="<?php echo get_template_directory_uri();?>/js/bootstrap.min.js"></script><?php get_footer(); ?>