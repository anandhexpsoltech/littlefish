<?php/* Template Name: Xero Callback Template */get_header();?><?phpglobal $wpdb;$tok_res = $wpdb->get_results("SELECT * FROM `xero_token`", ARRAY_A);?><div style="display: none;" id="loader-wrapper">    <div id="loader"></div></div><div class="main-container xero_main">    <div class="projects-section">        <div class="wrapper overflow xero_sec">            <h3>Xero Connection</h3>            <div class="logos">                <ul>                    <li class="litt_wid">                        <img title="little fish" src="<?php echo get_template_directory_uri(); ?>/img/little_fish_logo.png"/>                    </li>                    <li class="check_wid">                        <?php if(count($tok_res)){ ?>                            <span class="xero_hype_left">---</span>                            <div class="checkmark">                                <div class="checkmark_circle"></div>                                <div class="checkmark_stem"></div>                                <div class="checkmark_kick"></div>                            </div>                            <span class="xero_hype_right">---</span>                        <?php }else{ ?>                            <div class="close_icon">                                <span class="xero_hype_left">---</span>                                <span class="close-icon"></span>                                <span class="xero_hype_right">---</span>                            </div>                        <?php } ?>                    </li>                    <li class="xero_wid">                        <img title="xero" src="<?php echo get_template_directory_uri(); ?>/img/xero_logo.png"/>                    </li>                    <li class="xero_button">                        <?php if(count($tok_res)){ ?>                            <button class="dis_connect_button">Disconnect with Xero</button>                        <?php }else{ ?>                            <span class="xero_hidden" data-xero-sso data-label="Connecting with Xero" id="target"></span>                        <?php } ?>                    </li>                </ul>            </div>        </div>    </div></div><script type="text/javascript">    jQuery(document).ready(function () {        jQuery("#loader-wrapper").show();        var ajaxurl = "<?php echo admin_url('admin-ajax.php'); ?>";        <?php $code = $_GET['code'];        if($code){ ?>        var data = {            action: 'xero_callback',            code: '<?php echo $code; ?>'        };        jQuery.ajax({            type: 'post',            url: ajaxurl,            data: data,            success: function (response) {                console.log('check_response');                console.log(response);                if(response){                    try{                        var status = JSON.parse(response);                        console.log(status);                        if(status && status.code == '200'){                            jQuery("#loader-wrapper").hide();                            var xero_connect_url = "<?php echo get_site_url(); ?>/xero-connect";                            window.location.href = xero_connect_url;                        }                    }catch (e) {                        console.log(e);                    }                }            }        });       <?php } ?>        jQuery(document).on("click",".dis_connect_button",function() {            var ajaxurl = "<?php echo admin_url('admin-ajax.php'); ?>";            var data = {                action: 'xero_disconnect'            };            jQuery.ajax({                type: 'post',                url: ajaxurl,                data: data,                success: function (response) {                    console.log(response);                    if(response == 'records_cleared'){                        var xero_connect_url = "<?php echo get_site_url(); ?>/xero-connect";                        window.location.href = xero_connect_url;                    }                }            });        });    });</script><script src="https://edge.xero.com/platform/sso/xero-sso.js" async defer></script><?php get_footer(); ?>